esphome:
  name: esphome-web-7d26e0
  friendly_name: ESPHome-Screen-1
  min_version: 2025.9.0
  name_add_mac_suffix: false

  on_boot:
    priority: -10
    then:
      - light.turn_on:
          id: status_led
          red: 0.0
          green: 0.0
          blue: 0.0
          brightness: 20%
          # 100 Links Blau, Rechts Gr√ºn
          # 010 Alles an
          # 001 Alles an

esp32:
  variant: esp32
  framework:
    type: esp-idf

# Enable logging
logger:

# Enable Home Assistant API
api:      

# Allow Over-The-Air updates
ota:
- platform: esphome

wifi:
  ssid: !secret wifi_ssid
  password: !secret wifi_password

spi:
  - id: spi_bus1
    clk_pin: GPIO14
    mosi_pin: GPIO13
    miso_pin: GPIO12
  - id: spi_bus2
    clk_pin: GPIO25
    mosi_pin: GPIO32
    miso_pin: GPIO39

display:
  - platform: mipi_spi
    id: main_display
    model: ILI9341
    spi_id: spi_bus1
    dc_pin: GPIO2
    cs_pin: GPIO15
    invert_colors: False
    color_order: BGR
    color_depth: 16BIT
    dimensions:
      height: 240
      width: 320
    data_rate: 20000000.0
    rotation: 90
    auto_clear_enabled: false
    update_interval: never

light:
  - platform: monochromatic
    output: backlight_pwm
    restore_mode: ALWAYS_ON
    id: backlight
  - platform: rgb
    id: status_led
    name: "Status LED"
    red: status_red
    green: status_green
    blue: status_blue

output: 
  - platform: ledc
    pin: GPIO21
    id: backlight_pwm
  - platform: ledc
    pin: GPIO22
    id: status_red
  - platform: ledc
    pin: GPIO17
    id: status_green
  - platform: ledc
    pin: GPIO16
    id: status_blue

touchscreen:
  - platform: xpt2046
    id: xpt2046_touch
    spi_id: spi_bus2
    display: main_display
    cs_pin: GPIO33
    calibration: 
      x_min: 197
      x_max: 3749
      y_min: 288
      y_max: 3840
    transform: 
      swap_xy: True
      mirror_x: False
      mirror_y: False


binary_sensor:
  - platform: homeassistant
    entity_id: input_boolean.lvgl_toggle
    id: ha_flurlicht
    publish_initial_state: True
    on_state: 
      then:
        lvgl.widget.update:
          id: light_btn
          state:
            checked: !lambda return x;

lvgl:
  buffer_size: 25%

  pages:
      - id: main_page
        bg_color: 0x0000FF
        widgets:
          - button:
              id: light_btn
              align: CENTER
              width: 100
              height: 70
              checkable: true
              widgets:
                - label:
                    align: CENTER
                    text: 'Remote light'
              on_click: 
                - lambda: |-
                    ESP_LOGI("sensor", "Button pressed, calling script...");
                    id(toggle_lvgl).execute();
                #- lambda: |-
                #    ESP_LOGI("sensor", "on_click start");
                #- homeassistant.action:
                #    action: input_boolean.toggle
                #    data:
                #      entity_id: input_boolean.lvgl_toggle
                #    on_success:
                #      - lambda: |-
                #          ESP_LOGI("sensor", "on_click succeeded");
                #    on_error:
                #      - lambda: |-
                #          ESP_LOGI("sensor", "on_click failed");
                #- lambda: |-
                #    ESP_LOGI("sensor", "on_click end");

script:
  - id: toggle_lvgl
    then:
      - lambda: |-
          ESP_LOGI("sensor", "Script started...");
      - homeassistant.action:
          action: input_boolean.toggle
          data:
            entity_id: input_boolean.lvgl_toggle
          on_success:
            - lambda: |-
                ESP_LOGI("sensor", "Toggle succeeded!");
          on_error:
            - lambda: |-
                ESP_LOGI("sensor", "Toggle failed!");
      - lambda: |-
          ESP_LOGI("sensor", "Script finished.");