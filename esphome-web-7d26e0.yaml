esphome:
  name: esphome-web-7d26e0
  friendly_name: ESPHome-Screen-1
  min_version: 2025.9.0
  name_add_mac_suffix: false

esp32:
  variant: esp32
  framework:
    type: esp-idf

# Enable logging
logger:

# Enable Home Assistant API
api:

# Allow Over-The-Air updates
ota:
- platform: esphome

wifi:
  ssid: !secret wifi_ssid
  password: !secret wifi_password

font:
  - id: roboto
    file: "fonts/Roboto/Roboto-Regular.ttf"
    size: 24

spi:
  - id: spi_bus1
    clk_pin: GPIO14
    mosi_pin: GPIO13
    miso_pin: GPIO12
  - id: spi_bus2
    clk_pin: GPIO25
    mosi_pin: GPIO32
    miso_pin: GPIO39

display:
  - platform: mipi_spi
    id: main_display
    model: ILI9341
    spi_id: spi_bus1
    dc_pin: GPIO2
    cs_pin: GPIO15
    invert_colors: False
    color_order: BGR
    color_depth: 8BIT
    dimensions:
      height: 240
      width: 320
    data_rate: 20000000.0
    rotation: 90
    #lambda: |-
    #  auto yellow =  Color(255,255,0);
    #  auto red = Color(255, 0, 0);
    #  auto black = Color(0,0,0);
    #  it.fill(COLOR_OFF);
    #  it.print(10,10, id(roboto), "Hello YouTube!");
    #  it.print(10, 60, id(roboto), "I'm running ESPHome!");
    #  if (id(smiley).state) {
    #    it.filled_circle(it.get_width()/2, (it.get_height()/2)+50, 50, yellow);
    #  } else {
    #    it.filled_circle(it.get_width()/2, (it.get_height()/2)+50, 50, red);
    #  }
    #  it.filled_circle((it.get_width()/2)-20, (it.get_height()/2)+30, 5, black);
    #  it.filled_circle((it.get_width()/2)+20, (it.get_height()/2)+30, 5, black);
    #  it.filled_gauge((it.get_width()/2), (it.get_height()/2)+80, 25, 20, 100, black);
    lambda: |-
      it.fill(Color(20,20,20));

      auto x = 10;
      auto y = 10;
      auto title = "Flur";
      auto active = id(ha_flurlicht);
      
      auto bg = Color(40,40,40);
      auto border = Color(100,100,100);
      auto active_c = Color(0,120,255);
      auto inactive_c = Color(150,150,150);

      // Background
      it.filled_rectangle(x, y, 110, 80, bg);

      // Border
      it.rectangle(x, y, 110, 80, border);

      // Title
      it.printf(x + 10, y + 10, id(roboto), Color::WHITE, "%s", title);

      // State dot
      if (active)
        it.filled_circle(x + 90, y + 14, 6, active_c);
      else
        it.filled_circle(x + 90, y + 14, 6, inactive_c);

      // Icon
      if (active)
        it.filled_rectangle(x + 40, y + 35, 30, 30, active_c);
      else
        it.filled_rectangle(x + 40, y + 35, 30, 30, inactive_c);

light:
  - platform: monochromatic
    output: backlight_pwm
    restore_mode: ALWAYS_ON
    id: backlight

output: 
  - platform: ledc
    pin: GPIO21
    id: backlight_pwm

touchscreen:
  - platform: xpt2046
    id: xpt2046_touch
    spi_id: spi_bus2
    display: main_display
    cs_pin: GPIO33
    calibration: 
      x_min: 197
      x_max: 3749
      y_min: 288
      y_max: 3840
    transform: 
      swap_xy: True
      mirror_x: False
      mirror_y: False
    on_touch: 
      then:
        - switch.toggle: ha_flurlicht
        - lambda: |-
            ESP_LOGI("cal", "x=%d, y=%d, x_raw=%d, y_raw=%0d",
                touch.x,
                touch.y,
                touch.x_raw,
                touch.y_raw
                );


binary_sensor:
 # - platform: homeassistant
 #   entity_id: switch.smartswitch3_socket_1
 #   id: ha_flurlicht
  - platform: touchscreen
    id: smiley
    name: smiley
    x_min: 10
    x_max: 120
    y_min: 10
    y_max: 90
    on_press: 
      then:
        - lambda: |-
            ESP_LOGI("sensor", "pressed");
            id(main_display).update();
        
switch:
  - platform: homeassistant
    entity_id: switch.smartswitch3_socket_1
    id: ha_flurlicht
